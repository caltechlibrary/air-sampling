<head>
    <meta charset="UTF-8">
    <title>${title}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/phoenix/styles/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- Monthly Pager -->
    <script>
        /**
        * Monthly Pager Implementation
        * Dynamically manages a paginated month selector for iframe content
        */

        // Configuration
        const CONFIG = {
        // Format: [year, month] where month is 1-indexed (1=January)
        firstMonth: [2025, 3], // March 2025
        lastMonth: [2025, 7],  // July 2025
        // URL pattern with YYYY-MM placeholders
        urlPattern: 'https://caltechlibrary.github.io/air-sampling/phoenix/maps/YYYY-MM.html',
        };

        // Month names for display
        const MONTH_NAMES = [
        'January', 'February', 'March', 'April', 'May', 'June', 
        'July', 'August', 'September', 'October', 'November', 'December'
        ];

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
        // Generate months array
        const months = generateMonthsArray();
        
        // Set current month index based on system date
        let currentMonthIndex = getCurrentMonthIndex(months);
        
        // Get the DOM elements
        const iframe = document.querySelector('iframe');
        const pagination = document.querySelector('.pagination');
        const prevButton = pagination.querySelector('li:first-child');
        const middleButton = pagination.querySelector('li:nth-child(2)');
        const nextButton = pagination.querySelector('li:last-child');
        
        // Make sure the middle button exists and is set up correctly
        if (!middleButton) {
            // Create middle button if it doesn't exist
            const newMiddleButton = document.createElement('li');
            newMiddleButton.className = 'page-item active';
            newMiddleButton.setAttribute('aria-current', 'page');
            
            const link = document.createElement('a');
            link.className = 'page-link';
            link.href = '#';
            link.textContent = months[currentMonthIndex].name;
            
            newMiddleButton.appendChild(link);
            pagination.insertBefore(newMiddleButton, nextButton);
        }
        
        // Get the active button (should be the middle one now)
        const activeButton = pagination.querySelector('li.active') || middleButton;
        const monthLink = activeButton.querySelector('a');
        
        // Set up event listeners
        prevButton.querySelector('a').addEventListener('click', function(event) {
            event.preventDefault();
            if (currentMonthIndex > 0) {
            currentMonthIndex--;
            updateView();
            }
        });
        
        nextButton.querySelector('a').addEventListener('click', function(event) {
            event.preventDefault();
            if (currentMonthIndex < months.length - 1) {
            currentMonthIndex++;
            updateView();
            }
        });
        
        // Initial update
        updateView();
        
        /**
        * Update the iframe and pagination UI
        */
        function updateView() {
            // Update iframe source
            iframe.src = months[currentMonthIndex].url;
            
            // Update month text - using direct text assignment to ensure it works
            if (monthLink) {
            monthLink.textContent = months[currentMonthIndex].name;
            }
            
            // Update button states
            if (currentMonthIndex === 0) {
            prevButton.classList.add('disabled');
            } else {
            prevButton.classList.remove('disabled');
            }
            
            if (currentMonthIndex === months.length - 1) {
            nextButton.classList.add('disabled');
            } else {
            nextButton.classList.remove('disabled');
            }
        }
        
        /**
        * Generate array of all months between configured start and end dates
        */
        function generateMonthsArray() {
            const months = [];
            let currentYear = CONFIG.firstMonth[0];
            let currentMonth = CONFIG.firstMonth[1];
            
            const endYear = CONFIG.lastMonth[0];
            const endMonth = CONFIG.lastMonth[1];
            
            while (currentYear < endYear || (currentYear === endYear && currentMonth <= endMonth)) {
            // Create month label
            const monthName = `${MONTH_NAMES[currentMonth - 1]} ${currentYear}`;
            
            // Create URL with proper formatting
            const monthStr = currentMonth.toString().padStart(2, '0');
            const url = CONFIG.urlPattern
                .replace('YYYY', currentYear)
                .replace('MM', monthStr);
            
            months.push({ name: monthName, url: url });
            
            // Move to next month
            currentMonth++;
            if (currentMonth > 12) {
                currentMonth = 1;
                currentYear++;
            }
            }
            
            return months;
        }

        /**
        * Calculate the index of the current month based on system date
        */
        function getCurrentMonthIndex(months) {
            const today = new Date();
            const currentYear = today.getFullYear();
            const currentMonth = today.getMonth() + 1; // Convert to 1-indexed
            
            const [startYear, startMonth] = CONFIG.firstMonth;
            const [endYear, endMonth] = CONFIG.lastMonth;
            
            // Check if current date is within range
            if ((currentYear > startYear || (currentYear === startYear && currentMonth >= startMonth)) &&
                (currentYear < endYear || (currentYear === endYear && currentMonth <= endMonth))) {
            
            // Calculate months between first available month and current month
            let yearDiff = currentYear - startYear;
            let monthDiff = currentMonth - startMonth;
            return yearDiff * 12 + monthDiff;
            } else if (currentYear < startYear || (currentYear === startYear && currentMonth < startMonth)) {
            // Before first available month
            return 0;
            } else {
            // After last available month
            return months.length - 1;
            }
        }
        });
    </script>
    <!-- Matomo -->
    <script>
        var _paq = window._paq = window._paq || [];
        /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
            var u="https://caltechlibrary.matomo.cloud/";
            _paq.push(['setTrackerUrl', u+'matomo.php']);
            _paq.push(['setSiteId', '6']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.async=true; g.src='https://cdn.matomo.cloud/caltechlibrary.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
        </script>
        <!-- End Matomo Code -->
</head>
