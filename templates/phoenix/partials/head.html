<head>
    <meta charset="UTF-8">
    <title>${title}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/phoenix/styles/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- Monthly Pager -->
    <script>
        // Configure the first and last months (format: [year, month] where month is 1-indexed)
        const firstAvailableMonth = [2025, 3]; // March 2025
        const lastAvailableMonth = [2025, 7];  // July 2025

        // Base URL pattern for the maps (replace month in format YYYY-MM)
        const urlPattern = 'https://caltechlibrary.github.io/air-sampling/phoenix/maps/YYYY-MM.html';

        // Function to generate month array from first to last month
        function generateMonthsArray() {
        const months = [];
        let currentYear = firstAvailableMonth[0];
        let currentMonth = firstAvailableMonth[1];
        
        const endYear = lastAvailableMonth[0];
        const endMonth = lastAvailableMonth[1];
        
        // Generate all months between start and end (inclusive)
        while (currentYear < endYear || (currentYear === endYear && currentMonth <= endMonth)) {
            // Create month label
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                                'July', 'August', 'September', 'October', 'November', 'December'];
            const monthName = `${monthNames[currentMonth - 1]} ${currentYear}`;
            
            // Create URL with proper formatting
            const monthStr = currentMonth.toString().padStart(2, '0');
            const url = urlPattern.replace('YYYY', currentYear).replace('MM', monthStr);
            
            months.push({ name: monthName, url: url });
            
            // Move to next month
            currentMonth++;
            if (currentMonth > 12) {
            currentMonth = 1;
            currentYear++;
            }
        }
        
        return months;
        }

        // Generate months array
        const months = generateMonthsArray();

        // Function to determine the correct month index based on current date
        function getCurrentMonthIndex() {
        const today = new Date();
        const currentYear = today.getFullYear();
        const currentMonth = today.getMonth() + 1; // Convert to 1-indexed
        
        // Check if current date is within range
        if ((currentYear > firstAvailableMonth[0] || 
            (currentYear === firstAvailableMonth[0] && currentMonth >= firstAvailableMonth[1])) &&
            (currentYear < lastAvailableMonth[0] || 
            (currentYear === lastAvailableMonth[0] && currentMonth <= lastAvailableMonth[1]))) {
            
            // Calculate total months between first available month and current month
            let yearDiff = currentYear - firstAvailableMonth[0];
            let monthDiff = currentMonth - firstAvailableMonth[1];
            return yearDiff * 12 + monthDiff;
        } else if (currentYear < firstAvailableMonth[0] || 
                    (currentYear === firstAvailableMonth[0] && currentMonth < firstAvailableMonth[1])) {
            // Before first available month
            return 0;
        } else {
            // After last available month
            return months.length - 1;
        }
        }

        // Initialize with the current month based on system date
        let currentMonthIndex = getCurrentMonthIndex();

        // Function to update the iframe and pagination
        function updateMonthView() {
        // Update iframe source
        const iframe = document.querySelector('iframe');
        iframe.src = months[currentMonthIndex].url;
        
        // Get pagination elements
        const pagination = document.querySelector('.pagination');
        const prevButton = pagination.querySelector('li:first-child');
        const currentMonthButton = pagination.querySelector('li:nth-child(2)');
        const nextButton = pagination.querySelector('li:last-child');
        
        // Update current month link text
        const currentMonthLink = currentMonthButton.querySelector('a');
        currentMonthLink.textContent = months[currentMonthIndex].name;
        
        // Update previous button state
        if (currentMonthIndex === 0) {
            prevButton.classList.add('disabled');
        } else {
            prevButton.classList.remove('disabled');
        }
        
        // Update next button state
        if (currentMonthIndex === months.length - 1) {
            nextButton.classList.add('disabled');
        } else {
            nextButton.classList.remove('disabled');
        }
        }

        // Function to handle previous month navigation
        function navigateToPreviousMonth(event) {
        event.preventDefault();
        if (currentMonthIndex > 0) {
            currentMonthIndex--;
            updateMonthView();
        }
        }

        // Function to handle next month navigation
        function navigateToNextMonth(event) {
        event.preventDefault();
        if (currentMonthIndex < months.length - 1) {
            currentMonthIndex++;
            updateMonthView();
        }
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', () => {
        // Get pagination elements
        const pagination = document.querySelector('.pagination');
        const prevButton = pagination.querySelector('li:first-child');
        const currentMonthButton = pagination.querySelector('li.active');
        const nextButton = pagination.querySelector('li:last-child');
        
        // Set up event listeners for prev/next buttons
        const prevLink = prevButton.querySelector('a');
        prevLink.addEventListener('click', navigateToPreviousMonth);
        
        const nextLink = nextButton.querySelector('a');
        nextLink.addEventListener('click', navigateToNextMonth);
        
        // Initialize the view
        updateMonthView();
        });
    </script>
    <!-- Matomo -->
    <script>
        var _paq = window._paq = window._paq || [];
        /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
            var u="https://caltechlibrary.matomo.cloud/";
            _paq.push(['setTrackerUrl', u+'matomo.php']);
            _paq.push(['setSiteId', '6']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.async=true; g.src='https://cdn.matomo.cloud/caltechlibrary.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
        </script>
        <!-- End Matomo Code -->
</head>
